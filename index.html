<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bank Task Manager Compact</title>
    <style>
        :root { --bank-blue: #003366; --bg: #f0f2f5; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; }

        /* Floating Nav */
        .bottom-nav { position: fixed; bottom: 10px; left: 5%; width: 90%; background: white; display: flex; border-radius: 15px; height: 50px; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.2); border: 1px solid #ddd; }
        .nav-item { flex: 1; display: flex; align-items: center; justify-content: center; font-size: 13px; color: #888; border: none; background: none; font-weight: bold; }
        .nav-item.active { color: var(--bank-blue); }

        .page { display: none; padding: 10px; }
        .page.active { display: block; }

        .card { background: white; border-radius: 10px; padding: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 8px; }
        .input-box { width: 100%; border: 1px solid #ccc; border-radius: 6px; padding: 8px; font-size: 14px; margin-bottom: 5px; }
        
        /* Compact Header */
        .date-header { background: #e9ecef; padding: 8px 12px; font-weight: bold; border-radius: 8px; display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 4px; }
        
        /* Ultra Compact Task Item */
        .task-item { border-left: 4px solid #ccc; padding: 6px 10px; margin: 4px 0; background: #fff; border-radius: 4px; border: 1px solid #eee; position: relative; }
        .status-completed { border-left-color: #27ae60; background: #f0fff4; }
        .status-custpending { border-left-color: #9b59b6; background: #faf5ff; }
        .status-processing { border-left-color: #3498db; }

        .task-row { display: flex; justify-content: space-between; align-items: center; }
        .task-name { font-size: 14px; font-weight: bold; color: var(--bank-blue); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .task-meta { font-size: 11px; color: #666; }
        .rem-text { font-size: 11px; color: #888; font-style: italic; border-top: 1px solid #f0f0f0; margin-top: 2px; }

        /* Symbol Buttons */
        .sym-btn-row { display: flex; gap: 15px; margin-top: 5px; justify-content: flex-end; }
        .sym-btn { background: none; border: none; font-size: 18px; padding: 0; cursor: pointer; opacity: 0.8; }
        .sym-btn:active { transform: scale(1.2); opacity: 1; }

        .btn-add { background: var(--bank-blue); color: white; border: none; border-radius: 6px; padding: 8px; font-weight: bold; width: 100%; }
    </style>
</head>
<body>

    <div id="taskPage" class="page active">
        <div class="card" style="background: #fff9c4; padding: 8px;">
            <input type="date" id="globalDate" class="input-box">
            <input type="text" id="manualTitle" class="input-box" placeholder="Quick Name/Task">
            <button class="btn-add" onclick="addManualTask()">+ ADD TASK</button>
        </div>
        <div id="taskContainer"></div>
    </div>

    <div id="parsePage" class="page">
        <div class="card">
            <textarea id="rawInput" class="input-box" style="height: 80px;" placeholder="ID Acc Name Mob Rem / Next"></textarea>
            <button class="btn-add" onclick="bulkOrSingleParse()">PROCESS ( / )</button>
        </div>
        <div id="editArea" class="card" style="display:none; background: #e3f2fd;">
            <input type="hidden" id="editTaskId">
            <input type="text" id="editCustId" class="input-box" placeholder="ID">
            <input type="text" id="editAcc" class="input-box" placeholder="Acc No">
            <input type="text" id="editName" class="input-box" placeholder="Full Name">
            <input type="text" id="editPhone" class="input-box" placeholder="Mobile">
            <select id="editStatus" class="input-box">
                <option value="pending">Pending</option>
                <option value="processing">Processing</option>
                <option value="custpending">Cust-Pending</option>
                <option value="completed">Completed</option>
            </select>
            <textarea id="editRemarks" class="input-box" placeholder="Remarks..."></textarea>
            <button class="btn-add" style="background: #27ae60;" onclick="commitTask()">SAVE</button>
            <button class="btn-add" style="background: #888; margin-top:5px;" onclick="cancelEdit()">CANCEL</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <button class="nav-item active" onclick="switchPage('taskPage', this)">TASKS</button>
        <button class="nav-item" onclick="switchPage('parsePage', this)">PARSER</button>
    </nav>

<script>
    let db = JSON.parse(localStorage.getItem('bank_tasks_compact_v1')) || [];

    function switchPage(p, el) {
        document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
        document.getElementById(p).classList.add('active');
        el.classList.add('active');
        if(p === 'taskPage') renderTasks();
    }

    function parseLogic(text) {
        const w = text.trim().split(/\s+/);
        let id = w[0] || "", acc = w[1] || "", n = "", ph = "", rem = "";
        let count = 0, pIdx = -1;
        for(let i=0; i<w.length; i++){
            if(/^\d+$/.test(w[i])){ count++; if(count===3){ pIdx=i; ph=w[i]; break; } }
        }
        if(pIdx!==-1){ n=w.slice(2,pIdx).join(' '); rem=w.slice(pIdx+1).join(' '); }
        else { n=w.slice(2).join(' '); }
        return { id, acc, n, ph, rem };
    }

    function renderTasks() {
        const container = document.getElementById('taskContainer');
        container.innerHTML = "";
        const grouped = db.reduce((a, t) => { a[t.date] = a[t.date] || []; a[t.date].push(t); return a; }, {});

        Object.keys(grouped).sort().reverse().forEach(date => {
            const tasks = grouped[date];
            container.innerHTML += `
                <div class="date-header" onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display==='none'?'block':'none'">
                    <span>üìÖ ${date}</span> <span>${tasks.length} tasks</span>
                </div>
                <div style="display:none">
                    ${tasks.map(t => `
                        <div class="task-item status-${t.status}">
                            <div class="task-row">
                                <span class="task-name">${t.n}</span>
                                <span style="font-size:10px">${t.status==='custpending'?'üü£':t.status==='completed'?'üü¢':'‚ö™'}</span>
                            </div>
                            <div class="task-meta">ID: ${t.id} | A/c: ${t.acc}</div>
                            ${t.rem ? `<div class="rem-text">${t.rem}</div>` : ''}
                            <div class="sym-btn-row">
                                <button class="sym-btn" onclick="copyTask('${t.id}','${t.acc}','${t.n}','${t.rem}')">üìã</button>
                                <button class="sym-btn" onclick="editTask('${t.uid}')">‚úèÔ∏è</button>
                                <button class="sym-btn" onclick="moveTask('${t.uid}')">üìÖ</button>
                                <button class="sym-btn" onclick="deleteTask('${t.uid}')">üóëÔ∏è</button>
                            </div>
                        </div>
                    `).join('')}
                    <button class="btn-add" style="background:#6c757d; margin:10px 0;" onclick="emailReport('${date}')">üìß EMAIL REPORT</button>
                </div>`;
        });
    }

    function copyTask(id, acc, n, rem) {
        const txt = `Name: ${n}\nID: ${id}\nAcc: ${acc}\nRem: ${rem}`;
        navigator.clipboard.writeText(txt).then(() => alert("Copied"));
    }

    function moveTask(uid) {
        const d = prompt("New date (YYYY-MM-DD):", new Date().toISOString().split('T')[0]);
        if(d) { db = db.map(t => t.uid == uid ? {...t, date: d} : t); save(); }
    }

    function addManualTask() {
        const d = document.getElementById('globalDate').value;
        const t = document.getElementById('manualTitle').value;
        if(!d || !t) return;
        db.push({ uid: Date.now(), date: d, n: t, id: "M", acc: "M", ph: "", rem: "", status: "pending" });
        save();
        document.getElementById('manualTitle').value = "";
    }

    function bulkOrSingleParse() {
        const raw = document.getElementById('rawInput').value.trim();
        const date = document.getElementById('globalDate').value;
        if(raw.includes('/')) {
            raw.split('/').forEach(r => { if(r.trim()){ const p=parseLogic(r); db.push({uid: Date.now()+Math.random(), date, ...p, status:"pending"}); }});
            save(); switchPage('taskPage', document.querySelector('.nav-item'));
        } else {
            const p = parseLogic(raw);
            document.getElementById('editTaskId').value = "";
            document.getElementById('editCustId').value = p.id;
            document.getElementById('editAcc').value = p.acc;
            document.getElementById('editName').value = p.n;
            document.getElementById('editPhone').value = p.ph;
            document.getElementById('editRemarks').value = p.rem;
            document.getElementById('parserInputArea').style.display='none';
            document.getElementById('editArea').style.display='block';
        }
    }

    function editTask(uid) {
        const t = db.find(x => x.uid == uid);
        document.getElementById('editTaskId').value = t.uid;
        document.getElementById('editCustId').value = t.id;
        document.getElementById('editAcc').value = t.acc;
        document.getElementById('editName').value = t.n;
        document.getElementById('editPhone').value = t.ph;
        document.getElementById('editRemarks').value = t.rem;
        document.getElementById('editStatus').value = t.status;
        document.getElementById('parserInputArea').style.display='none';
        document.getElementById('editArea').style.display='block';
        switchPage('parsePage', document.querySelectorAll('.nav-item')[1]);
    }

    function commitTask() {
        const uid = document.getElementById('editTaskId').value;
        const data = { id: document.getElementById('editCustId').value, acc: document.getElementById('editAcc').value, n: document.getElementById('editName').value, ph: document.getElementById('editPhone').value, rem: document.getElementById('editRemarks').value, status: document.getElementById('editStatus').value };
        if(uid) db = db.map(t => t.uid == uid ? {...t, ...data} : t);
        else db.push({uid: Date.now(), date: document.getElementById('globalDate').value, ...data});
        save(); cancelEdit(); switchPage('taskPage', document.querySelector('.nav-item'));
    }

    function emailReport(date) {
        const tasks = db.filter(t => t.date === date);
        let body = `Report ${date}:\n\n` + tasks.map(t => `[${t.status}] ${t.n} (Acc: ${t.acc})`).join('\n');
        window.location.href = `mailto:?subject=Tasks ${date}&body=${encodeURIComponent(body)}`;
    }

    function save() { localStorage.setItem('bank_tasks_compact_v1', JSON.stringify(db)); renderTasks(); }
    function cancelEdit() { document.getElementById('parserInputArea').style.display='block'; document.getElementById('editArea').style.display='none'; }
    function deleteTask(uid) { if(confirm("Del?")) { db = db.filter(t => t.uid != uid); save(); } }
    document.getElementById('globalDate').valueAsDate = new Date();
    renderTasks();
</script>
</body>
</html>
