<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Bank Manager Pro + Team</title>
  <style>
    :root { --bank-blue:#003366; --bg:#f0f2f5; --muted:#6c757d; --ok:#27ae60; --warn:#3498db; --violet:#9b59b6; --danger:#d63031; }
    * { box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    body { font-family:-apple-system, system-ui, Segoe UI, Roboto, sans-serif; background:var(--bg); margin:0; padding-bottom:200px; color:#111; }

    .bottom-nav{
      position:fixed; bottom:20px; left:5%; width:90%; background:#fff; display:flex; 
      border-radius:15px; height:60px; z-index:1000; box-shadow:0 4px 15px rgba(0,0,0,0.2);
      border:1px solid #ddd; overflow:hidden;
    }
    .nav-item { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; font-size:10px; color:#888; border:none; background:none; font-weight:900; }
    .nav-item.active { color: var(--bank-blue); background: #f8f9fa; }
    .nav-item i { font-style: normal; font-size: 18px; margin-bottom: 2px; }

    .page { display:none; padding:8px; animation: fadeIn 0.2s; }
    .page.active { display:block; }
    @keyframes fadeIn { from {opacity:0} to {opacity:1} }

    .card { background:#fff; border-radius:12px; padding:10px; box-shadow:0 1px 3px rgba(0,0,0,0.1); margin-bottom:8px; border:1px solid #e9ecef; }
    .input-box { width:100%; border:1px solid #ccc; border-radius:8px; padding:9px; font-size:14px; margin-bottom:6px; outline:none; background:#fff; }
    
    .btn-add { background:var(--bank-blue); color:#fff; border:none; border-radius:10px; padding:12px; font-weight:900; width:100%; cursor:pointer; }
    .btn-ghost{ background:#eef2f7; color:#102a43; border:none; border-radius:10px; padding:10px; font-weight:900; width:100%; }
    .btn-danger{ background:var(--danger); color:#fff; border:none; border-radius:10px; padding:8px; font-weight:900; }

    /* Summary Section */
    .summary-box { background:#fff; border:1px solid #3498db; border-radius:10px; padding:10px; margin-bottom:10px; display:none; }
    .emp-row { display:flex; justify-content:space-between; padding:4px 0; border-bottom:1px solid #eee; font-size:13px; }
    .emp-row:last-child { border:0; }

    .date-header { background:#dee2e6; padding:10px; font-weight:900; border-radius:10px; margin-bottom:4px; display:flex; justify-content:space-between; align-items:center; cursor:pointer; }
    .task-item { border-left:5px solid #ccc; padding:10px; margin:6px 0; background:#fff; border-radius:10px; border:1px solid #eee; }
    .status-completed { border-left-color: var(--ok); }
    .status-processing { border-left-color: var(--warn); }
    .status-custpending { border-left-color: var(--violet); }
    
    .assignee-tag { font-size:10px; background:#e1f5fe; color:#01579b; padding:2px 6px; border-radius:4px; font-weight:bold; }
    .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,0.5); display:none; z-index:2000; align-items:center; justify-content:center; padding:15px; }
    .modal { background:#fff; width:100%; max-width:400px; padding:20px; border-radius:15px; }
    .toast { position:fixed; bottom:100px; left:50%; transform:translateX(-50%); background:#333; color:#fff; padding:8px 16px; border-radius:20px; font-size:12px; display:none; z-index:3000; }
  </style>
</head>
<body>

  <div id="taskPage" class="page active">
    <div class="card" style="background:#e3f2fd; border-color:#3498db;">
      <div style="display:flex; gap:5px;">
        <input type="date" id="globalDate" class="input-box" style="flex:1" />
        <select id="assignQuick" class="input-box" style="flex:1"><option value="">Assign to...</option></select>
      </div>
      <input type="text" id="manualTitle" class="input-box" placeholder="Customer Name" />
      <button class="btn-add" onclick="addManualTask()">+ QUICK ADD TASK</button>
    </div>

    <div class="card">
      <input id="searchBox" class="input-box" placeholder="Search tasks..." oninput="renderTasks()" />
      <button class="btn-ghost" style="font-size:11px;" onclick="toggleSummary()">üìä View Employee-wise Summary</button>
      <div id="dailySummary" class="summary-box"></div>
    </div>

    <div id="taskContainer"></div>
  </div>

  <div id="parsePage" class="page">
    <div class="card" id="parserInputArea">
        <h3 style="margin:0 0 10px 0; color:var(--bank-blue)">Bulk Parse & Assign</h3>
        <select id="assignBulk" class="input-box"><option value="">Default Assignee...</option></select>
        <textarea id="rawInput" class="input-box" style="height:120px;" placeholder="ID Acc Name Phone Remarks / Next record..."></textarea>
        <button class="btn-add" onclick="bulkOrSingleParse()">PROCESS ( / )</button>
    </div>

    <div id="editArea" class="card" style="display:none; background:#fff;">
      <h3 style="margin:0 0 10px 0; color:var(--bank-blue)">Edit Task</h3>
      <input type="hidden" id="editTaskId" />
      <select id="editAssignee" class="input-box"></select>
      <input type="text" id="editName" class="input-box" placeholder="Customer Name" />
      <div style="display:flex; gap:5px;">
        <input type="text" id="editCustId" class="input-box" placeholder="ID" />
        <input type="text" id="editAcc" class="input-box" placeholder="Acc No" />
      </div>
      <input type="text" id="editPhone" class="input-box" placeholder="Phone" />
      <select id="editStatus" class="input-box">
        <option value="pending">Pending</option>
        <option value="processing">Processing</option>
        <option value="custpending">Cust-Pending</option>
        <option value="completed">Completed</option>
      </select>
      <textarea id="editRemarks" class="input-box" placeholder="Remarks..." style="height:80px;"></textarea>
      <button class="btn-add" style="background:var(--ok)" onclick="commitTask()">SAVE CHANGES</button>
      <button class="btn-ghost" style="margin-top:6px;" onclick="cancelEdit()">CANCEL</button>
    </div>
  </div>

  <div id="empPage" class="page">
    <div class="card">
        <h3 style="margin:0 0 10px 0;">Employee Master</h3>
        <div style="display:flex; gap:5px;">
            <input type="text" id="newEmpName" class="input-box" placeholder="Staff Name" />
            <button class="btn-add" style="width:80px" onclick="addEmployee()">ADD</button>
        </div>
    </div>
    <div id="employeeList"></div>
    <br>
    <button class="btn-ghost" onclick="openBackup()">‚¨áÔ∏é Backup / Restore Data</button>
  </div>

  <nav class="bottom-nav">
    <button class="nav-item active" onclick="switchPage('taskPage', this)"><i>üìã</i>TASKS</button>
    <button class="nav-item" onclick="switchPage('parsePage', this)"><i>üîç</i>PARSER</button>
    <button class="nav-item" onclick="switchPage('empPage', this)"><i>üë•</i>STAFF</button>
  </nav>

  <div id="backupModal" class="modal-backdrop" onclick="closeModal('backupModal')">
    <div class="modal" onclick="event.stopPropagation()">
      <h3>Data Management</h3>
      <button class="btn-ghost" onclick="downloadBackup()">Download Backup</button>
      <textarea id="restoreBox" class="input-box" style="height:100px; margin-top:10px;" placeholder="Paste JSON here..."></textarea>
      <button class="btn-add" onclick="restoreBackup()">Restore</button>
    </div>
  </div>

  <div id="toast" class="toast"></div>

<script>
  let db = JSON.parse(localStorage.getItem('bank_tasks_v3')) || [];
  let emps = JSON.parse(localStorage.getItem('bank_emps_v3')) || [];

  function save() {
    localStorage.setItem('bank_tasks_v3', JSON.stringify(db));
    localStorage.setItem('bank_emps_v3', JSON.stringify(emps));
    updateDropdowns();
    renderTasks();
    renderEmployees();
  }

  function switchPage(p, el) {
    document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
    document.getElementById(p).classList.add('active');
    el.classList.add('active');
  }

  // === EMPLOYEE LOGIC ===
  function addEmployee() {
    const name = document.getElementById('newEmpName').value.trim();
    if (!name) return;
    emps.push(name);
    document.getElementById('newEmpName').value = '';
    save();
  }

  function deleteEmployee(idx) {
    if(confirm('Remove this employee?')) { emps.splice(idx,1); save(); }
  }

  function updateDropdowns() {
    const selectors = ['assignQuick', 'assignBulk', 'editAssignee'];
    selectors.forEach(id => {
        const el = document.getElementById(id);
        const val = el.value;
        el.innerHTML = '<option value="">Unassigned</option>' + 
            emps.map(e => `<option value="${e}">${e}</option>`).join('');
        el.value = val;
    });
  }

  function renderEmployees() {
    const cont = document.getElementById('employeeList');
    cont.innerHTML = emps.map((e, i) => `
        <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
            <b>${e}</b>
            <button class="btn-danger" onclick="deleteEmployee(${i})">DEL</button>
        </div>
    `).join('');
  }

  // === TASK LOGIC ===
  function addManualTask() {
    const name = document.getElementById('manualTitle').value.trim();
    const date = document.getElementById('globalDate').value;
    const emp = document.getElementById('assignQuick').value;
    if(!name || !date) return alert("Select Date & Name");
    db.push({ uid: Date.now(), date, n:name, emp, status:'pending', id:'M', acc:'M', ph:'', rem:'' });
    document.getElementById('manualTitle').value = '';
    save();
    showToast("Task Added");
  }

  function toggleSummary() {
    const box = document.getElementById('dailySummary');
    if (box.style.display === 'block') { box.style.display = 'none'; return; }
    
    const date = document.getElementById('globalDate').value;
    const tasks = db.filter(t => t.date === date);
    
    let html = `<b>Summary for ${date}</b><hr>`;
    const summary = {};
    
    emps.forEach(e => summary[e] = { p:0, c:0 });
    summary['Unassigned'] = { p:0, c:0 };

    tasks.forEach(t => {
        const key = t.emp || 'Unassigned';
        if (!summary[key]) summary[key] = { p:0, c:0 };
        if (t.status === 'completed') summary[key].c++;
        else summary[key].p++;
    });

    Object.keys(summary).forEach(name => {
        if(summary[name].p > 0 || summary[name].c > 0) {
            html += `<div class="emp-row">
                <span>${name}</span>
                <span>‚è≥ ${summary[name].p} | ‚úÖ ${summary[name].c}</span>
            </div>`;
        }
    });
    box.innerHTML = html || "No tasks for this date";
    box.style.display = 'block';
  }

  function renderTasks() {
    const cont = document.getElementById('taskContainer');
    const q = document.getElementById('searchBox').value.toLowerCase();
    cont.innerHTML = '';

    const grouped = {};
    db.forEach(t => {
        if (q && !JSON.stringify(t).toLowerCase().includes(q)) return;
        (grouped[t.date] = grouped[t.date] || []).push(t);
    });

    Object.keys(grouped).sort().reverse().forEach(date => {
        const tasks = grouped[date];
        cont.innerHTML += `
            <div class="date-header">üìÖ ${date} <span>${tasks.length} Tasks</span></div>
            <div>${tasks.map(t => `
                <div class="task-item status-${t.status}">
                    <div style="display:flex; justify-content:space-between;">
                        <b style="font-size:14px;">${t.n}</b>
                        ${t.emp ? `<span class="assignee-tag">üë§ ${t.emp}</span>` : ''}
                    </div>
                    <div style="font-size:11px; color:#666; margin:4px 0;">ID: ${t.id} | Acc: ${t.acc}</div>
                    <div style="font-size:12px; font-style:italic;">${t.rem}</div>
                    <div style="display:flex; gap:10px; margin-top:8px;">
                        <button onclick="editTask(${t.uid})" style="border:0; background:none;">‚úèÔ∏è Edit</button>
                        <button onclick="deleteTask(${t.uid})" style="border:0; background:none; color:red;">üóëÔ∏è Delete</button>
                        <button onclick="window.location.href='tel:${t.ph}'" style="border:0; background:none; color:blue;">üìû Call</button>
                    </div>
                </div>
            `).join('')}</div>
        `;
    });
  }

  // (Standard Parser Logic Integrated with Assignee)
  function parseLogic(text) {
    const w = text.trim().split(/\s+/);
    const id = w[0] || "N/A";
    const acc = w[1] || "N/A";
    let numStart = -1;
    for (let i = 2; i < w.length; i++) { if (/^\d+$/.test(w[i])) { numStart = i; break; } }
    if (numStart === -1) return { id, acc, n: w.slice(2).join(' '), ph: "", rem: "" };
    const n = w.slice(2, numStart).join(' ');
    let numEnd = numStart;
    while (numEnd < w.length && /^\d+$/.test(w[numEnd])) numEnd++;
    return { id, acc, n, ph: w.slice(numStart, numEnd).join(''), rem: w.slice(numEnd).join(' ') };
  }

  function bulkOrSingleParse() {
    const raw = document.getElementById('rawInput').value.trim();
    const date = document.getElementById('globalDate').value;
    const emp = document.getElementById('assignBulk').value;
    if(!raw) return;
    const records = raw.split('/');
    records.forEach(r => {
        const p = parseLogic(r);
        if(p.n) db.push({ uid: Date.now() + Math.random(), date, emp, status:'pending', ...p });
    });
    document.getElementById('rawInput').value = '';
    save();
    switchPage('taskPage', document.querySelectorAll('.nav-item')[0]);
  }

  function editTask(uid) {
    const t = db.find(x => x.uid == uid);
    document.getElementById('editTaskId').value = t.uid;
    document.getElementById('editName').value = t.n;
    document.getElementById('editAssignee').value = t.emp || "";
    document.getElementById('editCustId').value = t.id;
    document.getElementById('editAcc').value = t.acc;
    document.getElementById('editPhone').value = t.ph;
    document.getElementById('editStatus').value = t.status;
    document.getElementById('editRemarks').value = t.rem;
    document.getElementById('parserInputArea').style.display = 'none';
    document.getElementById('editArea').style.display = 'block';
    switchPage('parsePage', document.querySelectorAll('.nav-item')[1]);
  }

  function commitTask() {
    const uid = document.getElementById('editTaskId').value;
    const index = db.findIndex(x => x.uid == uid);
    db[index] = {
        ...db[index],
        n: document.getElementById('editName').value,
        emp: document.getElementById('editAssignee').value,
        id: document.getElementById('editCustId').value,
        acc: document.getElementById('editAcc').value,
        ph: document.getElementById('editPhone').value,
        status: document.getElementById('editStatus').value,
        rem: document.getElementById('editRemarks').value
    };
    save();
    cancelEdit();
    switchPage('taskPage', document.querySelectorAll('.nav-item')[0]);
  }

  function deleteTask(uid) { if(confirm('Delete?')) { db = db.filter(x => x.uid != uid); save(); } }
  function cancelEdit() { document.getElementById('parserInputArea').style.display = 'block'; document.getElementById('editArea').style.display = 'none'; }
  function openBackup() { document.getElementById('backupModal').style.display = 'flex'; }
  function closeModal(id) { document.getElementById(id).style.display = 'none'; }
  function showToast(m) { const t = document.getElementById('toast'); t.innerText = m; t.style.display = 'block'; setTimeout(() => t.style.display='none', 2000); }
  function downloadBackup() {
    const data = JSON.stringify({tasks:db, emps: emps});
    const blob = new Blob([data], {type: 'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'bank_data.json';
    a.click();
  }
  function restoreBackup() {
    try {
        const data = JSON.parse(document.getElementById('restoreBox').value);
        db = data.tasks || [];
        emps = data.emps || [];
        save();
        closeModal('backupModal');
        alert("Restored successfully");
    } catch(e) { alert("Invalid Data"); }
  }

  // Init
  document.getElementById('globalDate').value = new Date().toISOString().split('T')[0];
  save();
</script>
</body>
</html>
