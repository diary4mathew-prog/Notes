<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Bank Manager Pro</title>

<style>
:root{
  --bank-blue:#003366;
  --bg:#f0f2f5;
  --ok:#27ae60;
  --warn:#3498db;
  --violet:#9b59b6;
  --danger:#d63031;
}

*{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

body{
  font-family:-apple-system,system-ui,Segoe UI,Roboto,sans-serif;
  background:var(--bg);
  margin:0;
  padding-bottom:180px; /* EXTRA SPACE FOR FLOATING NAV */
  color:#111;
}

/* ---------- BOTTOM NAV (MOVED UP) ---------- */
.bottom-nav{
  position:fixed;
  bottom:50px;               /* << MOVED UP */
  left:5%;
  width:90%;
  height:54px;
  background:#fff;
  display:flex;
  border-radius:16px;
  z-index:1000;
  box-shadow:0 6px 18px rgba(0,0,0,0.25);
  border:1px solid #ddd;
}

.nav-item{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:13px;
  font-weight:800;
  color:#888;
  border:none;
  background:none;
}

.nav-item.active{ color:var(--bank-blue); }

/* ---------- PAGES ---------- */
.page{ display:none; padding:8px; }
.page.active{ display:block; }

/* ---------- CARDS ---------- */
.card{
  background:#fff;
  border-radius:12px;
  padding:10px;
  margin-bottom:8px;
  border:1px solid #e5e5e5;
  box-shadow:0 1px 3px rgba(0,0,0,0.1);
}

.input-box{
  width:100%;
  border:1px solid #ccc;
  border-radius:8px;
  padding:9px;
  font-size:14px;
  margin-bottom:6px;
}

.btn-add{
  background:var(--bank-blue);
  color:#fff;
  border:none;
  border-radius:10px;
  padding:10px;
  width:100%;
  font-weight:900;
}

.btn-add:active{ transform:scale(0.98); }

/* ---------- TASK LIST ---------- */
.date-header{
  background:#dee2e6;
  padding:8px 12px;
  font-weight:900;
  border-radius:10px;
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
  border:1px solid #cfd4da;
  cursor:pointer;
}

.task-item{
  background:#fff;
  border-radius:10px;
  padding:8px 10px;
  margin:6px 0;
  border-left:5px solid #bbb;
  border:1px solid #eee;
}

.status-pending{ border-left-color:#bbb; }
.status-processing{ border-left-color:var(--warn); background:#f2f8ff; }
.status-custpending{ border-left-color:var(--violet); background:#faf5ff; }
.status-completed{ border-left-color:var(--ok); background:#f0fff4; }

.task-name{
  font-size:14px;
  font-weight:900;
  color:var(--bank-blue);
}

.task-meta{
  font-size:11px;
  color:#555;
}

.rem-text{
  font-size:11px;
  color:#555;
  font-style:italic;
  border-top:1px dotted #ccc;
  margin-top:6px;
  padding-top:4px;
}

.sym-btn-row{
  display:flex;
  gap:14px;
  justify-content:flex-end;
  margin-top:6px;
}

.sym-btn{
  background:none;
  border:none;
  font-size:18px;
}

/* ---------- TOAST ---------- */
.toast{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:150px;              /* ABOVE NAV */
  background:#111;
  color:#fff;
  padding:10px 14px;
  border-radius:14px;
  font-size:12px;
  display:none;
  z-index:2000;
}
</style>
</head>

<body>

<!-- ================= TASK PAGE ================= -->
<div id="taskPage" class="page active">

  <div class="card" style="background:#fff9c4;border:1px solid #fbc02d;">
    <div style="display:flex;gap:6px;">
      <input type="date" id="globalDate" class="input-box" style="flex:1">
      <input type="text" id="manualTitle" class="input-box" placeholder="Customer Name" style="flex:2">
    </div>
    <button class="btn-add" onclick="addManualTask()">+ QUICK ADD</button>
  </div>

  <div id="taskContainer"></div>
</div>

<!-- ================= PARSER PAGE ================= -->
<div id="parsePage" class="page">

  <div class="card" id="parserInputArea">
    <textarea id="rawInput" class="input-box" style="height:110px;" placeholder="ID Acc Name Phone Remarks / Next..."></textarea>
    <button class="btn-add" onclick="bulkOrSingleParse()">PROCESS ( / )</button>
  </div>

  <div id="editArea" class="card" style="display:none;background:#e3f2fd;">
    <input type="hidden" id="editTaskId">

    <div style="display:flex;gap:6px;">
      <input id="editCustId" class="input-box" placeholder="ID">
      <input id="editAcc" class="input-box" placeholder="Acc">
    </div>

    <input id="editName" class="input-box" placeholder="Name">
    <input id="editPhone" class="input-box" placeholder="Phone">

    <select id="editStatus" class="input-box">
      <option value="pending">Pending</option>
      <option value="processing">Processing</option>
      <option value="custpending">Cust-Pending</option>
      <option value="completed">Completed</option>
    </select>

    <textarea id="editRemarks" class="input-box" placeholder="Remarks"></textarea>

    <button class="btn-add" onclick="commitTask()">SAVE</button>
    <button class="btn-add" style="background:#888;margin-top:6px;" onclick="cancelEdit()">CANCEL</button>
  </div>
</div>

<!-- ================= BOTTOM NAV ================= -->
<nav class="bottom-nav">
  <button class="nav-item active" onclick="switchPage('taskPage',this)">üìã TASKS</button>
  <button class="nav-item" onclick="switchPage('parsePage',this)">üîç PARSER</button>
</nav>

<div id="toast" class="toast"></div>

<script>
/* ---------- DATA ---------- */
let db = JSON.parse(localStorage.getItem('bank_tasks_v23')) || [];

/* ---------- UTIL ---------- */
const today = () => new Date().toISOString().slice(0,10);
const toast = msg => {
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.style.display='block';
  clearTimeout(t._x);
  t._x=setTimeout(()=>t.style.display='none',1800);
};

/* ---------- NAV ---------- */
function switchPage(p,el){
  document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'));
  document.getElementById(p).classList.add('active');
  el.classList.add('active');
  if(p==='taskPage') render();
}

/* ---------- PARSE LOGIC ---------- */
function parseLogic(text){
  const w=text.trim().split(/\s+/);
  const id=w[0]||"", acc=w[1]||"";
  const isNum=s=>/^\d+$/.test(s)||/^\+\d+$/.test(s);

  let i=2;
  while(i<w.length && !isNum(w[i])) i++;
  const n=w.slice(2,i).join(" ");
  let j=i;
  while(j<w.length && isNum(w[j])) j++;
  const ph=w.slice(i,j).join("");
  const rem=w.slice(j).join(" ");
  return {id,acc,n,ph,rem};
}

/* ---------- CRUD ---------- */
function addManualTask(){
  const d=document.getElementById('globalDate').value||today();
  const n=document.getElementById('manualTitle').value.trim();
  if(!n) return alert("Name required");
  db.push({uid:Date.now(),date:d,n,id:"M",acc:"M",ph:"",rem:"",status:"pending"});
  document.getElementById('manualTitle').value="";
  save();
}

function bulkOrSingleParse(){
  const raw=document.getElementById('rawInput').value.trim();
  const d=document.getElementById('globalDate').value||today();
  if(!raw) return;

  if(raw.includes('/')){
    raw.split('/').forEach(r=>{
      if(r.trim()) db.push({uid:Date.now()+Math.random(),date:d,...parseLogic(r),status:"pending"});
    });
    document.getElementById('rawInput').value="";
    save();
    switchPage('taskPage',document.querySelectorAll('.nav-item')[0]);
  }
}

function save(){
  localStorage.setItem('bank_tasks_v23',JSON.stringify(db));
  render();
}

/* ---------- RENDER ---------- */
function render(){
  const c=document.getElementById('taskContainer');
  c.innerHTML="";
  const g={};
  db.forEach(t=>(g[t.date]=g[t.date]||[]).push(t));

  Object.keys(g).sort().reverse().forEach(d=>{
    c.innerHTML+=`
      <div class="date-header" onclick="this.nextElementSibling.style.display=this.nextElementSibling.style.display==='none'?'block':'none'">
        <span>üìÖ ${d}</span><span>${g[d].length}</span>
      </div>
      <div style="display:block">
        ${g[d].map(t=>`
          <div class="task-item status-${t.status}">
            <div class="task-name">${t.n}</div>
            <div class="task-meta">ID:${t.id} | Acc:${t.acc} | ${t.ph}</div>
            ${t.rem?`<div class="rem-text">${t.rem}</div>`:""}
          </div>`).join("")}
      </div>`;
  });
}

/* ---------- INIT ---------- */
document.getElementById('globalDate').value=today();
render();
</script>
</body>
</html>
